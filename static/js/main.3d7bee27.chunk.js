(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{133:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},175:function(e,t,a){e.exports=a(362)},180:function(e,t,a){},181:function(e,t,a){},362:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(9),l=a.n(c),o=(a(180),a(133),a(181),a(11)),s=window.location.host;function i(e,t,a,n){var r;n&&(r=JSON.stringify(n));var c=new XMLHttpRequest,l="".concat(s,"/api/").concat(t);c.responseType="json";var o=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),n=0;n<a.length;n++){var r=a[n].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t}("csrftoken");c.open(e,l),c.setRequestHeader("Content-Type","application/json"),o&&(c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("X-CSRFToken",o)),c.onload=function(){a(c.response,c.status)},c.onerror=function(e){console.log(e),a({message:"The current states request was an error"},400)},c.send(r)}function m(e){var t=e.boilerState,a=new Date(t.start_time),n=new Date(t.end_time),c=n.getTime()-a.getTime();c=(c=c/1e3/60).toFixed(0);var l={day:"numeric",month:"short"},o={hour:"numeric",minute:"numeric"};return r.a.createElement("tr",null,r.a.createElement("td",null,a.toLocaleDateString("en-gb",l)," ",a.toLocaleTimeString("en-gb",o)),r.a.createElement("td",null,n.toLocaleDateString("en-gb",l)," ",n.toLocaleTimeString("en-gb",o)),r.a.createElement("td",null,c),r.a.createElement("td",null,t.hot_water_state?"ON":"OFF"),r.a.createElement("td",null,t.heating_state?"ON":"OFF"))}function u(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],s=e.limit;return Object(n.useEffect)((function(){i("GET","boilerStates/".concat(s),(function(e,t){200===t?l(e):alert("There was an error");var a=document.getElementById("history-table-spinner");a&&(a.innerHTML="")}),s)}),[]),c.map((function(e,t){return r.a.createElement(m,{boilerState:e,key:"".concat(t)})}))}s.startsWith("http")||(s="http://".concat(s));function d(e){var t=document.getElementById(e);t&&(t.innerHTML="")}function E(e){var t,a,n=e.agileRate,c=e.todaysMin,l=e.tmrsMin,o=new Date(n.valid_from),s=new Date(n.valid_to),i=n.rate,m=new Date,u={weekday:"short",day:"numeric",month:"short"},d={hour:"numeric",minute:"numeric"};return c.indexOf(n.valid_from)>-1?t="info":l.indexOf(n.valid_from)>-1?t="primary":i>15?t="danger":i<0?t="success":m>s?t="secondary":m<s&&m>o&&(t="light",a="font-weight-bold"),r.a.createElement("tr",{className:"table-".concat(t)},r.a.createElement("td",{className:a},o.toLocaleDateString("en-gb",u)," ",o.toLocaleTimeString("en-gb",d)),r.a.createElement("td",{className:a},s.toLocaleDateString("en-gb",u)," ",s.toLocaleTimeString("en-gb",d)),r.a.createElement("td",{className:a},i.toFixed(3),"p"))}function h(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],h=m[1],g=Object(n.useState)([]),p=Object(o.a)(g,2),b=p[0],v=p[1];return Object(n.useEffect)((function(){i("GET","agileRates",(function(e,t){200===t?(l(e.rates),h(e.todaysMin),v(e.tmrsMin)):alert("There was an error"),d("agile-rates-table-spinner")}))}),[]),c.map((function(e,t){return r.a.createElement(E,{agileRate:e,todaysMin:u,tmrsMin:b,key:"".concat(t)})}))}function g(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],E=m[1],h=Object(n.useState)([]),g=Object(o.a)(h,2),p=g[0],b=g[1],v=e.type;return Object(n.useEffect)((function(){i("GET","agileRates",(function(e,t){200===t?(l(e.rates),E(e.todaysMin),b(e.tmrsMin)):alert("There was an error"),d("agile-rates-card-spinner")}))}),[]),function(e){if(c.length<1)return"";for(var t,a=new Date(u[0]),n=new Date(p[0]),l=new Date,o=9999,s=[9999,9999],i=0;i<c.length;i++){var m,d,E=new Date(c[i].valid_from),h=new Date(c[i].valid_to);E<l&&l<h&&(o=c[i].rate,t=new Date(c[i].valid_from),i<c.length-1&&(s[0]=c[i+1].rate),i<c.length-2&&(s[1]=c[i+2].rate)),E.getTime()===a.getTime()?m=c[i].rate:E.getTime()===n.getTime()&&(d=c[i].rate)}var g={hour:"numeric",minute:"numeric"},b=function(e){return new Date(e).toLocaleTimeString("en-gb",g)};return"homepage"===e?r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Current"),r.a.createElement("h5",{className:"lead"},o.toFixed(3),"p"),r.a.createElement("span",{style:{fontSize:"95%"}},"since ",t.toLocaleTimeString("en-gb",g))),r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Today's Lowest"),r.a.createElement("h5",{className:"lead"},m?m.toFixed(3):"","p"),r.a.createElement("span",{style:{fontSize:"95%"}},"at ",u.map(b).join()))),r.a.createElement("hr",{className:"alert-dark my-4"}),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Next Two"),9999!==s[0]&&r.a.createElement("h5",{className:"lead"},s[0].toFixed(3),"p"),9999!==s[1]&&r.a.createElement("h5",{className:"lead"},s[1].toFixed(3),"p")),d&&r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Tomorrow's Lowest"),r.a.createElement("h5",{className:"lead"},d.toFixed(3),"p"),r.a.createElement("span",{style:{fontSize:"95%"}},"at ",p.map(b).join())))):r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement("div",{className:"col-md-4 col-sm-12 mb-3"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title mb-3"},"Current Rate"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},o.toFixed(3),"p"),r.a.createElement("h5",null,"since ",t.toLocaleTimeString("en-gb",g))))),r.a.createElement("div",{className:"col-md-4 col-sm-12 mb-3"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-titl mb-3"},"Today's Lowest"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},m?m.toFixed(3):"","p"),r.a.createElement("h5",null,"at ",u.map(b).join())))),r.a.createElement("div",{className:"col-md-4 col-sm-12 mb-3"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title mb-3"},"Tomorrow's Lowest"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},d?d.toFixed(3):"",d&&"p"),d&&r.a.createElement("h5",null,"at ",p.map(b).join())))))}(v)}function p(e){var t,a=e.controlState,n=e.operationState,c=e.boostState,l=e.cat;t=c||n?"danger":a?"warning":"success";var o,s="heating"===l?"Heating":"Water";o=c?"Boost\nOn":a?"hotWater"===l?"Scheduled\nControl":"Thermostat\nControl":"Control\nOff";return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-block btn-".concat(t),style:{maxWidth:130,whiteSpace:"pre-wrap"},onClick:function(e){e.preventDefault(),e.target.blur();i("POST","currentStates/change",(function(e,t){201===t?i("GET","currentStates",v,{}):alert("State change failed")}),{device:l,state:!a})}},r.a.createElement("h4",{class:"font-weight-bold alert-heading text-center pt-1"},s),r.a.createElement("hr",{className:"alert-".concat(t)}),r.a.createElement("h6",{className:"text-center"},o),r.a.createElement("hr",{className:"alert-".concat(t)}),r.a.createElement(b,{state:n,type:0})))}function b(e){var t=e.state?"ON":"OFF",a=1===e.type?"h3":"h4";return r.a.createElement(a,{className:"font-weight-bold text-center"},t)}function v(e,t){!function(e){var t=e?"danger":"success";document.getElementById("boiler-operation-block").className="alert alert-".concat(t),l.a.render(r.a.createElement(b,{state:e,type:1}),document.getElementById("boiler-on-off-text"))}(e.operation[2]),l.a.render(r.a.createElement(p,{controlState:e.control.hotWater.state,operationState:e.operation[0],boostState:e.control.hotWater.boost,cat:"hotWater"}),document.getElementById("hotWater-states-block")),l.a.render(r.a.createElement(p,{controlState:e.control.heating.state,operationState:e.operation[1],boostState:!1,cat:"heating"}),document.getElementById("heating-states-block"))}function f(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],d=m[1];e.type;return Object(n.useEffect)((function(){i("GET","googleNest",(function(e,t){200===t?(d(e.traits["sdm.devices.traits.ThermostatTemperatureSetpoint"].heatCelsius),l(e.traits["sdm.devices.traits.Temperature"].ambientTemperatureCelsius)):alert("There was an error")}))}),[]),"number"===typeof c?r.a.createElement("div",null,r.a.createElement("h5",null,"Ambient Temp:  ",c.toFixed(2)," "),r.a.createElement("h5",null,"Thermostat Set Temp: ",u.toFixed(2))):r.a.createElement("div",{class:"text-center"},r.a.createElement("div",{class:"spinner-border",role:"status"},r.a.createElement("span",{class:"sr-only"},"Loading...")))}var y=a(134),w=a(135),S=a(147),N=a(146),T=a(21),k=a(145),O=a(39);function j(e){var t=e.useBlock,a=new Date(t.interval_start),n=new Date(t.interval_start);n.setMinutes(a.getMinutes()+30);var c={day:"numeric",month:"short"},l={hour:"numeric",minute:"numeric"};return r.a.createElement("tr",null,r.a.createElement("td",null,a.toLocaleDateString("en-gb",c)," ",a.toLocaleTimeString("en-gb",l)),r.a.createElement("td",null,n.toLocaleDateString("en-gb",c)," ",n.toLocaleTimeString("en-gb",l)),r.a.createElement("td",null,t.rate.toFixed(3),"p"),r.a.createElement("td",null,t.consumption),r.a.createElement("td",null,(t.consumption*t.rate).toFixed(2),"p"))}function B(e){var t=e.useBlocks;return r.a.createElement(T.d,{width:"100%",height:500},r.a.createElement(T.b,{data:t},r.a.createElement(T.c,{stroke:"#ccc"}),r.a.createElement(T.e,{dataKey:"interval_start"}),r.a.createElement(T.f,null),r.a.createElement(n.Tooltip,null),r.a.createElement(T.a,{type:"monotone",dataKey:"consumption",stroke:"#8884d8"})))}function x(e){var t=e.useBlocks;return t&&r.a.createElement("div",{class:"row justify-content-center"},r.a.createElement("div",{class:"col-12"},r.a.createElement("div",{class:"card"},r.a.createElement("div",{class:"card-body"},r.a.createElement("table",{className:"table table-striped",style:{width:"100%"}},r.a.createElement("thead",{className:"thead-dark"},r.a.createElement("tr",null,r.a.createElement("th",null,"Start Time"),r.a.createElement("th",null,"End Time"),r.a.createElement("th",null,"Rate"),r.a.createElement("th",null,"Units Used (kWh)"),r.a.createElement("th",null,"Cost (p)"))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement(j,{useBlock:e,key:"".concat(t)})}))))))))}var L=function(e){Object(S.a)(a,e);var t=Object(N.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).state={useBlocks:[]},n}return Object(w.a)(a,[{key:"ToggleButtonGroupControlled",value:function(){return r.a.createElement(k.a,{type:"radio",name:"options",defaultValue:1,onChange:function(e){console.log(e)}},r.a.createElement(O.a,{value:1},"Average"),r.a.createElement(O.a,{value:2},"Sum"))}},{key:"componentDidMount",value:function(){var e=this;i("GET","consumptionHistory",(function(t,a){200===a?e.setState({useBlocks:t.leccyUse}):alert("There was an error")}))}},{key:"render",value:function(){return this.state.useBlocks?r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(B,{useBlocks:this.state.useBlocks})),r.a.createElement("div",{className:"my-3"},this.ToggleButtonGroupControlled()),r.a.createElement(x,{useBlocks:this.state.useBlocks})):r.a.createElement("div",{className:"text-center"},r.a.createElement("div",{className:"spinner-border",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var D=document.getElementById("root");D&&l.a.render(r.a.createElement(L,null),D);var F=document.getElementById("boilerStateRows");F&&l.a.render(r.a.createElement(u,{limit:0}),F);var C=document.getElementById("boilerStateCard");C&&l.a.render(r.a.createElement(u,{limit:5}),C);var I=document.getElementById("agileRateTable");I&&l.a.render(r.a.createElement(h,null),I);var R=document.getElementById("agile-rates-card");R&&l.a.render(r.a.createElement(g,{type:"homepage"}),R),(R=document.getElementById("agile-rates-page-cards"))&&l.a.render(r.a.createElement(g,{type:"top"}),R);var M=document.getElementById("nest-card-content");M&&l.a.render(r.a.createElement(f,null),M),document.getElementById("current-states-card-body")&&i("GET","currentStates",v,{});var _=document.getElementById("consumption-page");_&&l.a.render(r.a.createElement(L,null),_),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[175,1,2]]]);
//# sourceMappingURL=main.3d7bee27.chunk.js.map