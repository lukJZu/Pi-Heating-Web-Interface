(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{188:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},238:function(e,t,a){e.exports=a(453)},243:function(e,t,a){},244:function(e,t,a){},453:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(13),o=a.n(c),l=(a(243),a(188),a(244),a(20)),s=a(9),i=a.n(s),m=window.location.host;function u(e,t,a,n){var r;n&&(r=JSON.stringify(n));var c=new XMLHttpRequest,o="".concat(m,"/api/").concat(t);c.responseType="json";var l=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),n=0;n<a.length;n++){var r=a[n].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t}("csrftoken");c.open(e,o),c.setRequestHeader("Content-Type","application/json"),l&&(c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("X-CSRFToken",l)),c.onload=function(){a(c.response,c.status)},c.onerror=function(e){console.log(e),a({message:"The current states request was an error"},400)},c.send(r)}function d(e){var t=e.boilerState,a=i()(t.start_time),n=i()(t.end_time);return r.a.createElement("tr",null,r.a.createElement("td",null,a.format("DD MMM HH:mm")),r.a.createElement("td",null,n.format("DD MMM HH:mm")),r.a.createElement("td",null,n.diff(a,"m")),r.a.createElement("td",null,t.hot_water_state?"ON":"OFF"),r.a.createElement("td",null,t.heating_state?"ON":"OFF"))}function h(e){var t=Object(n.useState)([]),a=Object(l.a)(t,2),c=a[0],o=a[1],s=e.limit;return Object(n.useEffect)((function(){u("GET","boilerStates/".concat(s),(function(e,t){200===t?o(e):alert("There was an error");var a=document.getElementById("history-table-spinner");a&&(a.innerHTML="")}),s)}),[]),c.map((function(e,t){return r.a.createElement(d,{boilerState:e,key:"".concat(t)})}))}m.startsWith("http")||(m="http://".concat(m));function f(e){var t=document.getElementById(e);t&&(t.innerHTML="")}function p(e){var t,a,n=e.agileRate,c=e.todaysMin,o=e.tmrsMin,l=i()(n.valid_from),s=i()(n.valid_to),m=n.rate,u=i()();return c.indexOf(n.valid_from)>-1?t="info":o.indexOf(n.valid_from)>-1?t="primary":m>15?t="danger":m<0?t="success":u.isAfter(s)?t="secondary":u.isBetween(l,s)&&(t="light",a="font-weight-bold"),r.a.createElement("tr",{className:"table-".concat(t)},r.a.createElement("td",{className:a},l.format("ddd DD MMM HH:mm")),r.a.createElement("td",{className:a},s.format("ddd DD MMM HH:mm")),r.a.createElement("td",{className:a},m.toFixed(3),"p"))}function g(e){var t=Object(n.useState)([]),a=Object(l.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)([]),i=Object(l.a)(s,2),m=i[0],d=i[1],h=Object(n.useState)([]),g=Object(l.a)(h,2),E=g[0],v=g[1];return Object(n.useEffect)((function(){u("GET","agileRates",(function(e,t){200===t?(o(e.rates),d(e.todaysMin),v(e.tmrsMin)):alert("There was an error"),f("agile-rates-table-spinner")}))}),[]),c.map((function(e,t){return r.a.createElement(p,{agileRate:e,todaysMin:m,tmrsMin:E,key:"".concat(t)})}))}function E(e){var t=Object(n.useState)([]),a=Object(l.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)([]),m=Object(l.a)(s,2),d=m[0],h=m[1],p=Object(n.useState)([]),g=Object(l.a)(p,2),E=g[0],v=g[1],y=e.type;return Object(n.useEffect)((function(){u("GET","agileRates",(function(e,t){200===t?(o(e.rates),h(e.todaysMin),v(e.tmrsMin)):alert("There was an error"),f("agile-rates-card-spinner")}))}),[]),function(e){if(c.length<1)return"";for(var t=i()(d[0]),a=i()(E[0]),n=i()(),o=9999,l=[9999,9999],s=0;s<c.length;s++){var m,u,h=i()(c[s].valid_from),f=i()(c[s].valid_to);if(n.isBetween(h,f)){o=c[s].rate;var p=i()(c[s].valid_from);s<c.length-1&&(l[0]=c[s+1].rate),s<c.length-2&&(l[1]=c[s+2].rate)}h.isSame(t,"m")?m=c[s].rate:h.isSame(a,"m")&&(u=c[s].rate)}return"homepage"===e?r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Current"),r.a.createElement("h5",{className:"lead"},o.toFixed(3),"p"),r.a.createElement("span",{style:{fontSize:"95%"}},"since ",p.format("HH:mm"))),r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Today's Lowest"),r.a.createElement("h5",{className:"lead"},m?m.toFixed(3):"","p"),r.a.createElement("span",{style:{fontSize:"95%"}},"at ",d.map((function(e){return i()(e).format("HH:mm")})).join()))),r.a.createElement("hr",{className:"alert-dark my-4"}),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Next Two"),9999!==l[0]&&r.a.createElement("h5",{className:"lead"},l[0].toFixed(3),"p"),9999!==l[1]&&r.a.createElement("h5",{className:"lead"},l[1].toFixed(3),"p")),u&&r.a.createElement("div",{className:"col-6"},r.a.createElement("h4",{className:"display-6"},"Tomorrow's Lowest"),r.a.createElement("h5",{className:"lead"},u.toFixed(3),"p"),r.a.createElement("span",{style:{fontSize:"95%"}},"at ",E.map((function(e){return i()(e).format("HH:mm")})).join())))):r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement("div",{className:"col-md-4 col-sm-12 mb-3"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title mb-3"},"Current Rate"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},o.toFixed(3),"p"),r.a.createElement("h5",null,"since ",p.format("HH:mm"))))),r.a.createElement("div",{className:"col-md-4 col-sm-12 mb-3"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-titl mb-3"},"Today's Lowest"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},m?m.toFixed(3):"","p"),r.a.createElement("h5",null,"at ",d.map((function(e){return i()(e).format("HH:mm")})).join())))),r.a.createElement("div",{className:"col-md-4 col-sm-12 mb-3"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title mb-3"},"Tomorrow's Lowest"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},u?u.toFixed(3):"",u&&"p"),u&&r.a.createElement("h5",null,"at ",E.map((function(e){return i()(e).format("HH:mm")})).join())))))}(y)}function v(e){var t,a=e.controlState,n=e.operationState,c=e.boostState,o=e.cat;t=c||n?"danger":a?"warning":"success";var l,s="heating"===o?"Heating":"Water";l=c?"Boost\nOn":a?"hotWater"===o?"Scheduled\nControl":"Thermostat\nControl":"Control\nOff";return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-block btn-".concat(t),style:{maxWidth:130,whiteSpace:"pre-wrap"},onClick:function(e){e.preventDefault(),e.target.blur();u("POST","currentStates/change",(function(e,t){201===t?u("GET","currentStates",b,{}):alert("State change failed")}),{device:o,state:!a})}},r.a.createElement("h4",{class:"font-weight-bold alert-heading text-center pt-1"},s),r.a.createElement("hr",{className:"alert-".concat(t)}),r.a.createElement("h6",{className:"text-center"},l),r.a.createElement("hr",{className:"alert-".concat(t)}),r.a.createElement(y,{state:n,type:0})))}function y(e){var t=e.state?"ON":"OFF",a=1===e.type?"h3":"h4";return r.a.createElement(a,{className:"font-weight-bold text-center"},t)}function b(e,t){!function(e){var t=e?"danger":"success";document.getElementById("boiler-operation-block").className="alert alert-".concat(t),o.a.render(r.a.createElement(y,{state:e,type:1}),document.getElementById("boiler-on-off-text"))}(e.operation[2]),o.a.render(r.a.createElement(v,{controlState:e.control.hotWater.state,operationState:e.operation[0],boostState:e.control.hotWater.boost,cat:"hotWater"}),document.getElementById("hotWater-states-block")),o.a.render(r.a.createElement(v,{controlState:e.control.heating.state,operationState:e.operation[1],boostState:!1,cat:"heating"}),document.getElementById("heating-states-block"))}function w(e){var t=Object(n.useState)([]),a=Object(l.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)([]),i=Object(l.a)(s,2),m=i[0],d=i[1];e.type;return Object(n.useEffect)((function(){u("GET","googleNest",(function(e,t){200===t?(d(e.traits["sdm.devices.traits.ThermostatTemperatureSetpoint"].heatCelsius),o(e.traits["sdm.devices.traits.Temperature"].ambientTemperatureCelsius)):alert("There was an error")}))}),[]),"number"===typeof c?r.a.createElement("div",null,r.a.createElement("h5",null,"Ambient Temp:  ",c.toFixed(2)," "),r.a.createElement("h5",null,"Thermostat Set Temp: ",m.toFixed(2))):r.a.createElement("div",{class:"text-center"},r.a.createElement("div",{class:"spinner-border",role:"status"},r.a.createElement("span",{class:"sr-only"},"Loading...")))}var S=a(17),N=a(189),O=a(190),k=a(88),T=a(214),x=a(212),M=a(36),j=a(211),H=a(102),F=a(462),V=a(457),B=a(458),C=a(459),R=a(460),D=a(461).a.RangePicker,I={avg:{value:"avg",label:"Average"},actl:{value:"actl",label:"Actual"}},Y={hour:{label:"Hourly",avgStringFormat:"HH:mm",actlStringFormat:"DD MMM HH:mm"},day:{label:"Daily",avgStringFormat:"dddd",actlStringFormat:"YYYY-MM-DD"},week:{label:"Weekly",avgStringFormat:"WW YYYY",actlStringFormat:"WW YYYY"},month:{label:"Monthly",avgStringFormat:"MMMM",actlStringFormat:"MMM YYYY"}};function L(e){var t,a=e.btnType,n=e.stateVar,c=e.onValueChange;"type"===a?t=I:"view"===a&&(t=Y);return r.a.createElement(j.a,{size:"lg",type:"radio",name:"options",defaultValue:n,onChange:function(e,t){t.target.blur(),c([a,e])}},Object.keys(t).map((function(e){return r.a.createElement(H.a,{value:e},t[e].label)})))}function W(e,t){for(var a=[],n=i()(e[1]).endOf(t),r=i()(e[0]);r.isBefore(n);r.add(1,t))a.push(r.format(Y[t].actlStringFormat));return a}function A(e){var t=e.data;return t?r.a.createElement(M.f,{width:"100%",height:500},r.a.createElement(M.c,{data:t},r.a.createElement(M.b,{stroke:"#ccc"}),r.a.createElement(M.g,{dataKey:"x"}),r.a.createElement(M.h,{yAxisId:"left",type:"number",dataKey:"consumption",name:"Use",unit:"kWh"}),r.a.createElement(M.h,{yAxisId:"right",orientation:"right",type:"number",dataKey:"rate",name:"Rate",unit:"p"}),r.a.createElement(M.a,{yAxisId:"left",type:"monotone",dataKey:"consumption",stroke:"#8884d8"}),r.a.createElement(M.e,{yAxisId:"right",type:"monotone",dataKey:"rate",stroke:"#8884d8"}),r.a.createElement(M.d,null),r.a.createElement(n.Tooltip,null))):""}function P(e){var t=e.dataPlot;return t.rate?r.a.createElement("tr",null,r.a.createElement("td",null,t.x),r.a.createElement("td",null,t.rate&&"".concat(t.rate.toFixed(3),"p")),r.a.createElement("td",null,t.consumption&&t.consumption.toFixed(3)),r.a.createElement("td",null,0!==t.cost&&"".concat((t.consumption*t.rate).toFixed(2),"p"))):""}function _(e){var t=e.dataPlots;return t?r.a.createElement("div",{class:"row justify-content-center"},r.a.createElement("div",{class:"col-12"},r.a.createElement("div",{class:"card"},r.a.createElement("div",{class:"card-body"},r.a.createElement("table",{className:"table table-striped",style:{width:"100%"}},r.a.createElement("thead",{className:"thead-dark"},r.a.createElement("tr",null,r.a.createElement("th",null,"Time"),r.a.createElement("th",null,"Rate"),r.a.createElement("th",null,"Units Used (kWh)"),r.a.createElement("th",null,"Cost"))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement(P,{dataPlot:e,key:"".concat(t)})})))))))):""}var q=function(e){Object(T.a)(a,e);var t=Object(x.a)(a);function a(e){var n;Object(N.a)(this,a),(n=t.call(this,e)).chartOptionChanged=function(e){"type"===e[0]?(n.chartType=e[1],localStorage.setItem("consumptionPage/chartType",e[1])):"view"===e[0]&&(n.chartView=e[1],localStorage.setItem("consumptionPage/chartView",e[1])),n.processAnyViewTypeChange()},n.datesChanged=function(e){e&&(localStorage.setItem("consumptionPage/dateRange",e.map((function(e){return e.format("L")})).join(",")),n.setState({dateRange:e},n.processAnyViewTypeChange))};var r=localStorage.getItem("consumptionPage/dateRange");r=r?r.split(",").map((function(e){return i()(e,"L")})):[i()(),i()()],n.state={useBlocks:[],dataPlot:[],dateRange:r};var c=localStorage.getItem("consumptionPage/chartView");n.chartView=c||"hour";var o=localStorage.getItem("consumptionPage/chartType");return n.chartType=o||"avg",n.datesLimit=[i()(),i()()],n.datesChanged=n.datesChanged.bind(Object(k.a)(n)),n}return Object(O.a)(a,[{key:"processAnyViewTypeChange",value:function(){var e=this.chartView,t=[];"avg"===this.chartType?"day"===e?t=i.a.weekdays():"week"===e?t=W(this.state.dateRange,e):"month"===e&&(t=i.a.months()):"hour"!==e&&(t=W(this.state.dateRange,e));var a=t.map((function(e){return{x:e}}));a="avg"===this.chartType?this.processAvgView(a):this.processActlView(a),this.setState({dataPlot:a})}},{key:"processAvgView",value:function(e){var t=this;if("hour"===this.chartView){for(var a=[],n=0;n<24;n++)a.push(i()({hour:n}).format(Y.hour.avgStringFormat)),a.push(i()({hour:n,minute:30}).format(Y.hour.avgStringFormat));var r=F.a(this.state.useBlocks,(function(e){return e.time.format(Y[t.chartView].avgStringFormat)}));e=a.map((function(e){var t=r.get(e);return{x:e,rate:V.a(t,(function(e){return e.rate})),consumption:V.a(t,(function(e){return e.consumption})),cost:V.a(t,(function(e){return e.rate*e.consumption}))}}))}else{this.chartView;var c=F.b(this.state.useBlocks,(function(e){return e.time.format("LL")}));c=c.map((function(e){return{x:e[0],rate:V.a(e[1],(function(e){return e.rate})),use:B.a(e[1],(function(e){return e.consumption})),cost:B.a(e[1],(function(e){return e.consumption*e.rate})),count:C.a(e[1],(function(e){return e.consumption}))}}));var o,l=Y[this.chartView].avgStringFormat,s=Object(S.a)(e);try{for(s.s();!(o=s.n()).done;){var m=o.value,u=R.a(c,(function(e){return i()(e.x,"LL").format(l)===m.x}));"week"===this.chartView&&(m.x="".concat(i()(m.x,l).startOf("week").format("DD"),"-").concat(i()(m.x,l).endOf("week").format("DD MMM YYYY"))),m.rate=V.a(u,(function(e){return e.count>45?e.rate:null})),m.consumption=V.a(u,(function(e){return e.count>45?e.use:null})),m.cost=V.a(u,(function(e){return e.count>45?e.cost:null}))}}catch(d){s.e(d)}finally{s.f()}}return e}},{key:"processActlView",value:function(e){if("hour"===this.chartView){var t=i()(this.state.dateRange[0]),a=i()(this.state.dateRange[1]).add(1,"d"),n=i()(t).add(11,"d");(e=R.a(this.state.useBlocks,(function(e){return e.time.isBetween(t,a,"minute","[)")&&e.time.isBefore(n)})).map((function(e){return{x:e.time.format("DD MMM HH:mm"),rate:e.rate,consumption:e.consumption,cost:e.rate*e.consumption}}))).reverse()}else{this.chartView;var r=Y[this.chartView].actlStringFormat,c=F.b(this.state.useBlocks,(function(e){return e.time.format(r)}));console.log(c),c=c.map((function(e){return{x:e[0],rate:V.a(e[1],(function(e){return e.rate})),use:B.a(e[1],(function(e){return e.consumption})),cost:B.a(e[1],(function(e){return e.consumption*e.rate}))}}));var o,l=Object(S.a)(e);try{for(l.s();!(o=l.n()).done;){var s=o.value,m=R.a(c,(function(e){return e.x===s.x}));"week"===this.chartView&&(s.x="".concat(i()(s.x,r).startOf("week").format("DD"),"-").concat(i()(s.x,r).endOf("week").format("DD MMM YYYY"))),s.rate=V.a(m,(function(e){return e.rate})),s.consumption=B.a(m,(function(e){return e.use})),s.cost=B.a(m,(function(e){return e.cost}))}}catch(u){l.e(u)}finally{l.f()}}return e}},{key:"componentDidMount",value:function(){var e=this;u("GET","consumptionHistory",(function(t,a){if(200===a){var n=t.leccyUse;n=n.map((function(e){return{time:i()(e.interval_start),rate:e.rate,consumption:e.consumption}})),e.setState({useBlocks:n},e.processAnyViewTypeChange);var r=n.map((function(e){return e.time}));e.datesLimit=[i.a.min(r).subtract(1,"d"),i.a.max(r)]}else alert("There was an error")}))}},{key:"render",value:function(){var e=this;return this.state.useBlocks?r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(A,{data:this.state.dataPlot})),r.a.createElement("div",{className:"row justify-content-center my-3"},r.a.createElement("div",{className:"col-lg-3 my-1",align:"center"},r.a.createElement(L,{btnType:"type",stateVar:this.chartType,onValueChange:this.chartOptionChanged})),r.a.createElement("div",{className:"col-lg-5 my-1",align:"center"},r.a.createElement(L,{btnType:"view",stateVar:this.chartView,onValueChange:this.chartOptionChanged})),r.a.createElement("div",{className:"col-lg-4 my-1",align:"center"},r.a.createElement(D,{size:"large",defaultValue:this.state.dateRange,onChange:this.datesChanged,disabledDate:function(t){return t&&!t.isBetween(e.datesLimit[0],e.datesLimit[1])}}))),r.a.createElement(_,{dataPlots:this.state.dataPlot})):r.a.createElement("div",{className:"text-center"},r.a.createElement("div",{className:"spinner-border",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var G=document.getElementById("root");G&&o.a.render(r.a.createElement(q,null),G);var z=document.getElementById("boilerStateRows");z&&o.a.render(r.a.createElement(h,{limit:0}),z);var K=document.getElementById("boilerStateCard");K&&o.a.render(r.a.createElement(h,{limit:5}),K);var U=document.getElementById("agileRateTable");U&&o.a.render(r.a.createElement(g,null),U);var X=document.getElementById("agile-rates-card");X&&o.a.render(r.a.createElement(E,{type:"homepage"}),X),(X=document.getElementById("agile-rates-page-cards"))&&o.a.render(r.a.createElement(E,{type:"top"}),X);var J=document.getElementById("nest-card-content");J&&o.a.render(r.a.createElement(w,null),J),document.getElementById("current-states-card-body")&&u("GET","currentStates",b,{});var $=document.getElementById("consumption-page");$&&o.a.render(r.a.createElement(q,null),$),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[238,1,2]]]);
//# sourceMappingURL=main.63f293ae.chunk.js.map