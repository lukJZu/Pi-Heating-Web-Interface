(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{241:function(e,t,a){e.exports=a(458)},246:function(e,t,a){},456:function(e,t,a){},457:function(e,t,a){},458:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(13),l=a.n(c),o=(a(246),a(18)),i=a(3),s=a.n(i),m=window.location.host;function d(e,t,a,n){var r;n&&(r=JSON.stringify(n));var c=new XMLHttpRequest,l="".concat(m,"/api/").concat(t);c.responseType="json";var o=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),n=0;n<a.length;n++){var r=a[n].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t}("csrftoken");c.open(e,l),c.setRequestHeader("Content-Type","application/json"),o&&(c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("X-CSRFToken",o)),c.onload=function(){a(c.response,c.status)},c.onerror=function(e){console.log(e),a({message:"The current states request was an error"},400)},c.send(r)}function u(e){var t=e.boilerState,a=s()(t.start_time),n=s()(t.end_time);return r.a.createElement("tr",null,r.a.createElement("td",null,a.format("ddd DD MMM HH:mm")),r.a.createElement("td",null,n.format("ddd DD MMM HH:mm")),r.a.createElement("td",null,n.diff(a,"m")),r.a.createElement("td",null,t.hot_water_state?"ON":"OFF"),r.a.createElement("td",null,t.heating_state?"ON":"OFF"))}function h(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],i=e.limit;return Object(n.useEffect)((function(){d("GET","boilerStates/".concat(i),(function(e,t){200===t?l(e):alert("There was an error");var a=document.getElementById("history-table-spinner");a&&(a.innerHTML="")}),i)}),[]),c.map((function(e,t){return r.a.createElement(u,{boilerState:e,key:"".concat(t)})}))}m.startsWith("http")||(m="http://".concat(m));var f=a(17),g=a(52),v=a(53),p=a(37),E=a(58),b=a(57),y=a(25),k=a(137),w=a.n(k),S=a(465),C=S.a.RangePicker,O=function(e){Object(E.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).getScheduleCallback=function(e,t){200===t||201===t?n.setState({schedule:e}):alert("Error in retrieving schedule")},n.state={schedule:[],editMode:!1},n.editScheduleRowsEl=[],n.editButtonClicked=n.editButtonClicked.bind(Object(p.a)(n)),n.finishButtonClicked=n.finishButtonClicked.bind(Object(p.a)(n)),n.setEditRowRefs=n.setEditRowRefs.bind(Object(p.a)(n)),n.addScheduleClicked=n.addScheduleClicked.bind(Object(p.a)(n)),n}return Object(v.a)(a,[{key:"editButtonClicked",value:function(e){this.editScheduleRowsEl=[],this.setState({editMode:!this.state.editMode})}},{key:"finishButtonClicked",value:function(e){var t,a=[],n=Object(f.a)(this.editScheduleRowsEl);try{for(n.s();!(t=n.n()).done;){var r=t.value,c=r.state.hotWaterState,l=r.state.heatingState;if(c||l){var o={start_time:r.state.timeRange[0].utc().format("YYYY-MM-DD HH:mm:ssZ"),end_time:r.state.timeRange[1].utc().format("YYYY-MM-DD HH:mm:ssZ"),hot_water_state:c,heating_state:l};a.push(o)}}}catch(i){n.e(i)}finally{n.f()}d("POST","schedule/set",this.getScheduleCallback,a),this.setState({editMode:!1})}},{key:"setEditRowRefs",value:function(e){this.editScheduleRowsEl.push(e)}},{key:"addScheduleClicked",value:function(e){var t={start_time:s()().startOf("day"),end_time:s()().startOf("day"),hot_water_state:!1,heating_state:!1};this.setState({schedule:this.state.schedule.concat([t])})}},{key:"componentDidMount",value:function(){d("GET","schedule",this.getScheduleCallback)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"card-body"},r.a.createElement("h4",{className:"card-title mb-3"},"Schedule"),r.a.createElement("div",null,r.a.createElement("table",{className:"table table-striped",style:{width:"100%"}},r.a.createElement("thead",{className:"thead-dark"},r.a.createElement("tr",null,r.a.createElement("th",null,"Start Time"),r.a.createElement("th",null,"End Time"),r.a.createElement("th",null,"Hot Water"),r.a.createElement("th",null,"Heating"))),r.a.createElement("tbody",null,this.state.editMode?this.state.schedule.map((function(t,a){return r.a.createElement(x,{schedule:t,ref:e.setEditRowRefs,key:a})})):this.state.schedule.map((function(e,t){return r.a.createElement(N,{schedule:e,key:t})})))),this.state.editMode&&r.a.createElement(y.a,{className:"mb-4",variant:"info",onClick:this.addScheduleClicked,block:!0},"Add Schedule")),this.state.editMode?r.a.createElement(y.a,{className:"float-right",onClick:this.finishButtonClicked},"Finish"):r.a.createElement(y.a,{className:"float-right",onClick:this.editButtonClicked},"Edit"))}}]),a}(n.Component);function N(e){var t=e.schedule,a=s()(t.start_time),n=s()(t.end_time);return r.a.createElement("tr",{className:s()().isBetween(a,n)?"table-danger":""},r.a.createElement("td",null,a.format("ddd Do HH:mm")),r.a.createElement("td",null,n.format("ddd Do HH:mm")),r.a.createElement("td",null,t.hot_water_state?"ON":"OFF"),r.a.createElement("td",null,t.heating_state?"ON":"OFF"))}var x=function(e){Object(E.a)(a,e);var t=Object(b.a)(a);function a(e){var n;Object(g.a)(this,a),n=t.call(this,e);var r=e.schedule;return n.state={timeRange:[s()(r.start_time),s()(r.end_time)],hotWaterState:r.hot_water_state,heatingState:r.heating_state},n.stateChanged=n.stateChanged.bind(Object(p.a)(n)),n}return Object(v.a)(a,[{key:"stateChanged",value:function(e,t,a){a.includes("heating")?this.setState({heatingState:e}):this.setState({hotWaterState:e})}},{key:"disabledDate",value:function(e){return e&&!e.isBetween(s()().startOf("date"),s()().add(1,"days").endOf("date"),"day","[]")}},{key:"render",value:function(){var e=this;return r.a.createElement("tr",null,r.a.createElement("td",{style:{alignContent:"center"},colSpan:"2"},r.a.createElement(C,{value:this.state.timeRange,disabledDate:this.disabledDate,format:"D/M HH:mm:ss",showTime:!0,onChange:function(t){e.setState({timeRange:t})}})),r.a.createElement("td",null,r.a.createElement(w.a,{className:"react-switch",id:"hot-water-state-checkbox",checked:this.state.hotWaterState,onChange:this.stateChanged,uncheckedIcon:!1,checkedIcon:!1,onColor:"#3498DB"})),r.a.createElement("td",null,r.a.createElement(w.a,{className:"react-switch",id:"heating-state-checkbox",checked:this.state.heatingState,onChange:this.stateChanged,uncheckedIcon:!1,checkedIcon:!1,onColor:"#3498DB"})))}}]),a}(n.Component);function M(e){var t=document.getElementById(e);t&&(t.innerHTML="")}var R=a(14);function j(e){var t,a=e.agileRate,n=e.todaysMin,c=e.tmrsMin,l=s()(a.valid_from),o=s()(a.valid_to),i=a.rate,m=s()(),d="";return n.indexOf(a.valid_from)>-1?d="info":c.indexOf(a.valid_from)>-1?d="primary":i>15?d="danger":i<0?d="success":m.isAfter(o)?d="secondary":m.isBetween(l,o)&&(d="light"),m.isBetween(l,o)&&(t={fontSize:"larger",fontWeight:"bold"}),r.a.createElement("tr",{className:"table-".concat(d)},r.a.createElement("td",{style:t},l.format("ddd DD MMM HH:mm")),r.a.createElement("td",{style:t},o.format("ddd DD MMM HH:mm")),r.a.createElement("td",{style:t},i.toFixed(3),"p"))}function T(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],i=Object(n.useState)([]),s=Object(o.a)(i,2),m=s[0],u=s[1],h=Object(n.useState)([]),f=Object(o.a)(h,2),g=f[0],v=f[1];return Object(n.useEffect)((function(){d("GET","agileRates",(function(e,t){200===t?(l(e.rates),u(e.todaysMin),v(e.tmrsMin)):alert("There was an error"),M("agile-rates-table-spinner")}))}),[]),c.map((function(e,t){return r.a.createElement(j,{agileRate:e,todaysMin:m,tmrsMin:g,key:"".concat(t)})}))}function B(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],i=Object(n.useState)([]),m=Object(o.a)(i,2),u=m[0],h=m[1],f=Object(n.useState)([]),g=Object(o.a)(f,2),v=g[0],p=g[1],E=e.type;return Object(n.useEffect)((function(){d("GET","agileRates",(function(e,t){200===t?(l(e.rates),h(e.todaysMin),p(e.tmrsMin)):alert("There was an error"),M("agile-rates-card-spinner")}))}),[]),function(e){if(c.length<1)return"";for(var t=s()(u[0]),a=s()(v[0]),n=s()(),l=9999,o=[9999,9999,9999,9999],i=0;i<c.length;i++){var m,d,h=s()(c[i].valid_from),f=s()(c[i].valid_to);if(n.isBetween(h,f)){l=c[i].rate;var g=s()(c[i].valid_from);i<c.length-1&&(o[0]=c[i+1].rate),i<c.length-2&&(o[1]=c[i+2].rate),i<c.length-3&&(o[2]=c[i+3].rate),i<c.length-3&&(o[3]=c[i+3].rate)}h.isSame(t,"m")?m=c[i].rate:h.isSame(a,"m")&&(d=c[i].rate)}return"homepage"===e?r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement(D,{data:c,minRates:[m,d]})),r.a.createElement("hr",{className:"alert-dark my-3"}),r.a.createElement("div",{className:"ml-1 mt-3 row"},r.a.createElement("div",{className:"col-3"},r.a.createElement("h5",null,"Next Rates")),r.a.createElement("div",null,r.a.createElement("h6",{className:"align-bottom"},o.map((function(e){return"".concat(e.toFixed(3),"p")+"\u2003\u2003"})))))):r.a.createElement("div",{className:"row justify-content-center mb-3"},r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title mb-3"},"Current Rate"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},l.toFixed(3),"p"),r.a.createElement("h5",null,"since ",g.format("HH:mm"))))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-titl mb-3"},"Today's Lowest"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},"number"===typeof m?m.toFixed(3):"","p"),r.a.createElement("h5",null,"at ",u.map((function(e){return s()(e).format("HH:mm")})).join())))),"number"===typeof d&&r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title mb-3"},"Tomorrow's Lowest"),r.a.createElement("h3",{className:"font-weight-bold mb-3"},"number"===typeof d?d.toFixed(3):"","number"===typeof d&&"p"),"number"===typeof d&&r.a.createElement("h5",null,"at ",v.map((function(e){return s()(e).format("HH:mm")})).join())))))}(E)}function D(e){var t,a=e.data,n=e.minRates;a.forEach((function(e,a){var r=s()(e.valid_from),c=s()(e.valid_to);s()().isBetween(r,c)?(e.color="#ffffff",t=a):e.rate>34.9?e.color="#ff0000":e.rate>30?e.color="#ff7b00":e.rate>20?e.color="#e09d00":e.rate>15?e.color="#edea26":n.includes(e.rate)?e.color="#00ff00":e.color="#795ae090"}));return a?r.a.createElement(R.i,{width:"100%",height:250},r.a.createElement(R.d,{data:a,margin:{left:-15,right:15,top:18}},r.a.createElement(R.b,{stroke:"#aaaaaaaa"}),r.a.createElement(R.k,{dataKey:"valid_from",tick:{fontSize:"small"},tickFormatter:function(e){return s()(e).format("HH:mm")}}),r.a.createElement(R.l,{yAxisId:"rate",orientation:"left",type:"number",tick:{fontSize:"small"},name:"Rate",unit:"p",ticks:[0,5,10,15,20,25,30,35],interval:"preserveStartEnd"}),r.a.createElement(R.h,{y:35,yAxisId:"rate",stroke:"#f00",strokeWidth:1.25}),r.a.createElement(R.h,{y:0,yAxisId:"rate",stroke:"#8884d8",strokeWidth:1.25}),r.a.createElement(R.a,{yAxisId:"rate",fill:"#000000",name:"Rate",dataKey:"rate",stroke:"#8884d8"},a.map((function(e,t){return r.a.createElement(R.c,{key:"cell-".concat(t),stroke:e.color})})),r.a.createElement(R.e,{dataKey:"rate",position:"top",content:function(e){var a=e.x,n=e.y,c=e.width;e.height,e.value;return e.index===t?r.a.createElement("g",null,r.a.createElement("text",{x:a+c/2,y:n-7,fill:"#fff",textAnchor:"middle",dominantBaseline:"middle",fontSize:"small"},e.value.toFixed(2))):""}})),r.a.createElement(R.h,{y:14.6,yAxisId:"rate",stroke:"#795ae09",strokeWidth:1}),r.a.createElement(R.j,{content:r.a.createElement(Y,null)}))):""}function Y(e){var t=e.active,a=e.payload,n=e.label;if(t&&n&&a){var c=a.find((function(e){return"rate"===e.dataKey}));return r.a.createElement("div",{className:"custom-tooltip"},r.a.createElement("p",{className:"tooltip-x-value",style:{fontSize:"90%"}},"".concat(s()(n).format("HH:mm"))," "),c&&r.a.createElement("div",{className:"tooltip-value-avgCost",style:{color:"#bbbbbb"}},r.a.createElement("p",null,c.value.toFixed(3),"p")))}return""}function H(e){var t,a=e.controlState,n=e.operationState,c=e.boostState,l=e.cat;t=c||n?"danger":a?"warning":"success";var o,i="heating"===l?"Heating":"Water";o=c?"Boost\nOn":a?"hotWater"===l?"Scheduled\nControl":"Thermostat\nControl":"Control\nOff";return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-block btn-".concat(t),style:{maxWidth:160,whiteSpace:"pre-wrap"},onClick:function(e){e.preventDefault(),e.target.blur();d("POST","currentStates/change",(function(e,t){201===t?d("GET","currentStates",I,{}):alert("State change failed")}),{device:l,state:!a})}},r.a.createElement("h4",{class:"font-weight-bold alert-heading text-center pt-1"},i),r.a.createElement("hr",{className:"alert-".concat(t)}),r.a.createElement("h6",{className:"text-center"},o),r.a.createElement("hr",{className:"alert-".concat(t)}),r.a.createElement(F,{state:n,type:0})))}function F(e){var t=e.state?"ON":"OFF",a=1===e.type?"h3":"h4";return r.a.createElement(a,{className:"font-weight-bold text-center"},t)}function I(e,t){!function(e){var t=e?"danger":"success";document.getElementById("boiler-operation-block").className="alert alert-".concat(t),l.a.render(r.a.createElement(F,{state:e,type:1}),document.getElementById("boiler-on-off-text"))}(e.operation[2]),l.a.render(r.a.createElement(H,{controlState:e.control.hotWater.state,operationState:e.operation[0],boostState:e.control.hotWater.boost,cat:"hotWater"}),document.getElementById("hotWater-states-block")),l.a.render(r.a.createElement(H,{controlState:e.control.heating.state,operationState:e.operation[1],boostState:!1,cat:"heating"}),document.getElementById("heating-states-block"))}function V(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],i=Object(n.useState)([]),s=Object(o.a)(i,2),m=s[0],u=s[1];return Object(n.useEffect)((function(){d("GET","googleNest",(function(e,t){200===t?("heatCelsius"in e.traits["sdm.devices.traits.ThermostatTemperatureSetpoint"]&&u(e.traits["sdm.devices.traits.ThermostatTemperatureSetpoint"].heatCelsius),l(e.traits["sdm.devices.traits.Temperature"].ambientTemperatureCelsius)):alert("Error in retrieving Nest Data")}))}),[]),"number"===typeof c?r.a.createElement("div",null,r.a.createElement("h5",null,"Ambient Temp:  ",c.toFixed(2)," "),r.a.createElement("h5",null,"Thermostat Set Temp: ","number"===typeof m&&m.toFixed(2))):r.a.createElement("div",{class:"text-center"},r.a.createElement("div",{class:"spinner-border",role:"status"},r.a.createElement("span",{class:"sr-only"},"Loading...")))}var P=a(461),W=a(466),A=a(462),_=a(463),L=a(464),K=a(144),z=a(48),U=S.a.RangePicker;function G(e){var t,a=e.btnType,n=e.stateVar,c=e.onValueChange;if("type"===a)t=ae;else if("view"===a)t=ne;else if("plot"===a){for(var l={},i=0,s=Object.entries(te);i<s.length;i++){var m=Object(o.a)(s[i],2),d=m[0],u=m[1];"rate"!==d&&"avgCost"!==d&&(l[d]=u)}t=l}return r.a.createElement(K.a,{type:"radio",name:"options",size:"lg",defaultValue:n,onChange:function(e,t){t.target.blur(),c([a,e])}},Object.keys(t).map((function(e,a){return r.a.createElement(z.a,{value:e,key:"".concat(a)},t[e].label)})))}var q=function(e){Object(E.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).datesChanged=function(e){n.setState({dateRange:e,preSelection:null})},n.buttonDateRangeClicked=function(e){var t;"day"===e?t=[s()().subtract(1,"d").set({hour:0,minute:0,second:0,millisecond:0}),s()().subtract(1,"d").set({hour:0,minute:0,second:0,millisecond:0})]:"week"===e?t=[s.a.max(s()().subtract(8,"d"),n.props.datesLimit[0]),s()().subtract(1,"d")]:"month"===e?t=[s.a.max(s()().subtract({months:1,days:1}),n.props.datesLimit[0]),s()().subtract(1,"d")]:"all"===e&&(t=n.props.datesLimit),n.setState({dateRange:t,preSelection:e})},n.state={dateRange:e.dateRange,preSelection:null},n}return Object(v.a)(a,[{key:"componentDidUpdate",value:function(e,t){t.dateRange!==this.state.dateRange&&this.props.datesChanged(this.state.dateRange)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"row align-items-center"},r.a.createElement("div",{className:"col-6",align:"right"},r.a.createElement(K.a,{type:"radio",name:"options",value:this.state.preSelection,onChange:this.buttonDateRangeClicked},r.a.createElement(z.a,{value:"all"},"All",r.a.createElement("br",null),"Time"),r.a.createElement(z.a,{value:"month"},"Past",r.a.createElement("br",null),"Month"),r.a.createElement(z.a,{value:"week"},"Past",r.a.createElement("br",null),"Week"),r.a.createElement(z.a,{value:"day"},"Past",r.a.createElement("br",null),"Day"))),r.a.createElement("div",{className:"col-6 ",align:"left"},r.a.createElement(U,{size:"large",allowClear:!1,inputReadOnly:!0,value:this.state.dateRange,onChange:this.datesChanged,disabledDate:function(t){return t&&!t.isBetween(e.props.datesLimit[0],e.props.datesLimit[1],"[]")}})))}}]),a}(n.Component);function X(e){var t=e.data,a=e.barPlotOptions;return t?r.a.createElement(R.i,{width:"100%",height:500},r.a.createElement(R.d,{data:t},r.a.createElement(R.b,{stroke:"#aaaaaaaa"}),r.a.createElement(R.k,{dataKey:"x"}),r.a.createElement(R.l,{yAxisId:"left",type:"number",dataKey:a.key,name:a.label,unit:a.unit}),r.a.createElement(R.l,{yAxisId:"rate",orientation:"right",type:"number",name:"Rate",unit:"p"}),r.a.createElement(R.h,{y:0,yAxisId:"rate",stroke:"#8884d8",strokeWidth:1.25}),r.a.createElement(R.h,{y:14.6,yAxisId:"rate",stroke:"#795ae090",strokeWidth:1}),r.a.createElement(R.a,{yAxisId:"left",fill:"#000000",name:a.label,dataKey:a.key,stroke:"#8884d8"}),r.a.createElement(R.h,{y:0,yAxisId:"left",stroke:"white",strokeWidth:1}),r.a.createElement(R.g,{yAxisId:"rate",type:"monotone",name:"Rate",dot:!1,dataKey:"rate",stroke:"#555555",legendType:"none"}),r.a.createElement(R.g,{yAxisId:"rate",type:"monotone",name:"Average Unit Cost",dataKey:"avgCost",stroke:"#8884d8"}),r.a.createElement(R.f,null),r.a.createElement(R.j,{content:r.a.createElement(J,null)}))):""}function J(e){var t=e.active,a=e.payload,n=e.label;if(t&&n&&a){var c=a.find((function(e){return"avgCost"===e.dataKey})),l=a.find((function(e){return"avgCost"!==e.dataKey&&"rate"!==e.dataKey})),o=a.find((function(e){return"rate"===e.dataKey}));return r.a.createElement("div",{className:"custom-tooltip"},r.a.createElement("p",{className:"tooltip-x-value"},"".concat(n)," "),l&&r.a.createElement("div",{className:"tooltip-value-y"},r.a.createElement("p",null,"".concat(te[l.dataKey].label,": "),l.value.toFixed(3),te[l.dataKey].unit)),c&&r.a.createElement("div",{className:"tooltip-value-avgCost"},r.a.createElement("p",null,"".concat(te.avgCost.label,": "),c.value.toFixed(3),te.avgCost.unit)),o&&r.a.createElement("div",{className:"tooltip-value-rate"},r.a.createElement("p",null,"".concat(te.rate.label,": "),o.value.toFixed(3),te.rate.unit)))}return""}function Z(e){var t=e.dataPlot,a=e.chartView,n="";return null!=t.consumption&&(n="hour"===a||"day"===a?"".concat(t.cost.toFixed(2),"p"):"\xa3".concat((t.cost/100).toFixed(2))),void 0!==t.rate&&null!==t.rate?r.a.createElement("tr",null,r.a.createElement("td",null,t.x),r.a.createElement("td",null,"".concat(t.rate.toFixed(3),"p")),r.a.createElement("td",null,null!=t.consumption&&t.consumption.toFixed(3)),r.a.createElement("td",null,n),r.a.createElement("td",null,null!=t.consumption&&"".concat(t.avgCost.toFixed(3),"p"))):""}function $(e){var t=e.dataPlots,a=e.chartType,n=e.chartView,c="Rate",l="Used (kWh)",o="Cost";"avg"===a&&"hour"!==n?(c="Mean Daily Rate",l="Mean Daily Use (kWh)",o="Mean Daily Cost"):"avg"===a&&"hour"===n?(c="Mean Block Rate",l="Mean Use (kWh)",o="Mean Cost"):"actl"===a&&"hour"!==n&&(c="Mean Block Rate");var i,s=0,m=0,d=Object(f.a)(t);try{for(d.s();!(i=d.n()).done;){var u=i.value;s+=u.consumption?u.consumption:0,m+=u.cost?u.cost:0}}catch(g){d.e(g)}finally{d.f()}var h=r.a.createElement("tr",{className:"table-secondary font-weight-bold",style:{fontSize:"135%"}},r.a.createElement("td",{className:"text-center",colSpan:2},"Sum of all time periods"),r.a.createElement("td",null,"Total Use: ",s.toFixed(3),"kWh"),r.a.createElement("td",null,"Total Cost: \xa3",(m/100).toFixed(2)),r.a.createElement("td",null,"Average Unit Cost: ",(m/s).toFixed(3),"p"));return t?r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement("div",{className:"col-12"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body table-responsive-sm"},r.a.createElement("table",{className:"table table-striped",style:{width:"100%",tableLayout:"fixed"}},r.a.createElement("tbody",null,h,r.a.createElement("tr",{className:"table-secondary font-weight-bold",style:{fontSize:"110%"}},r.a.createElement("th",null,"Period"),r.a.createElement("th",null,c),r.a.createElement("th",null,l),r.a.createElement("th",null,o),r.a.createElement("th",null,"Average Unit Cost (per kWh)")),t.map((function(e,t){return r.a.createElement(Z,{dataPlot:e,chartView:n,key:"".concat(t)})})))))))):""}function Q(e,t){for(var a=[],n=s()(e[1]).endOf(t),r=s()(e[0]);r.isBefore(n);r.add(1,t))a.push(r.format(ne[t].actlStringFormat));return a}var ee=function(e){Object(E.a)(a,e);var t=Object(b.a)(a);function a(e){var n;Object(g.a)(this,a),(n=t.call(this,e)).chartOptionChanged=function(e){"type"===e[0]?(n.chartType=e[1],localStorage.setItem("consumptionPage/chartType",e[1]),n.processAnyViewTypeChange()):"view"===e[0]?(n.chartView=e[1],localStorage.setItem("consumptionPage/chartView",e[1]),n.processAnyViewTypeChange()):"plot"===e[0]&&(localStorage.setItem("consumptionPage/chartPlot",e[1]),n.setState({chartBarPlot:e[1]}))},n.prevNextClicked=function(e){var t,a=n.state.dateRange,r=e.target.id,c="hour"===n.chartView?"days":n.chartView;"prev-date-range"===r?(t=a.map((function(e){return s()(e).subtract(1,c)})))[0].isBefore(n.state.datesLimit[0])&&(t=a):(t=a.map((function(e){return s()(e).add(1,c)})))[1].isAfter(n.state.datesLimit[1])&&(t=a),n.dateRangeElement.current.datesChanged(t)},n.datesChanged=function(e){e&&(localStorage.setItem("consumptionPage/dateRange",e.map((function(e){return e.format("L")})).join(",")),n.setState({dateRange:e},n.processAnyViewTypeChange))};var c=localStorage.getItem("consumptionPage/dateRange"),l=localStorage.getItem("consumptionPage/chartType"),o=localStorage.getItem("consumptionPage/chartView"),i=localStorage.getItem("consumptionPage/chartPlot");return n.state={useBlocks:[],dataPlot:[],dateRange:c?c.split(",").map((function(e){return s()(e,"L")})):[s()(),s()()],chartBarPlot:i||"cost",datesLimit:[s()(),s()()]},n.chartView=o||"hour",n.chartType=l||"avg",n.dateRangeElement=r.a.createRef(),n.datesChanged=n.datesChanged.bind(Object(p.a)(n)),n}return Object(v.a)(a,[{key:"processAnyViewTypeChange",value:function(){var e=this.chartView,t=[];"avg"===this.chartType?"day"===e?t=s.a.weekdays():"week"===e?t=Q(this.state.dateRange,e):"month"===e&&(t=s.a.months()):"hour"!==e&&(t=Q(this.state.dateRange,e));var a=t.map((function(e){return{x:e}}));a="avg"===this.chartType?this.processAvgView(a):this.processActlView(a);var n,r=Object(f.a)(a);try{for(r.s();!(n=r.n()).done;){var c=n.value;c.avgCost=c.consumption>=0?c.cost/c.consumption:null}}catch(l){r.e(l)}finally{r.f()}this.setState({dataPlot:a})}},{key:"processAvgView",value:function(e){var t,a=this;if("hour"===this.chartView){t=P.a(this.state.useBlocks,(function(e){return e.time.isSameOrAfter(a.state.dateRange[0])&&e.time.isBefore(a.state.dateRange[1].endOf("day"))}));for(var n=[],r=0;r<24;r++)n.push(s()({hour:r}).format(ne.hour.avgStringFormat)),n.push(s()({hour:r,minute:30}).format(ne.hour.avgStringFormat));var c=W.a(t,(function(e){return e.time.format(ne[a.chartView].avgStringFormat)}));e=n.map((function(e){var t=c.get(e);return t?{x:e,rate:A.a(t,(function(e){return e.rate})),consumption:A.a(t,(function(e){return e.consumption})),cost:A.a(t,(function(e){return e.rate*e.consumption}))}:{x:e,rate:null,consumption:null,cost:null}}))}else{t=P.a(this.state.useBlocks,(function(e){return e.time.isSameOrAfter(a.state.dateRange[0])&&e.time.isBefore(a.state.dateRange[1].endOf(a.chartView))}));var l=W.b(t,(function(e){return e.time.format("L")}));l=l.map((function(e){return{x:e[0],rate:A.a(e[1],(function(e){return e.rate})),use:_.a(e[1],(function(e){return e.consumption})),cost:_.a(e[1],(function(e){return e.consumption>=0?e.consumption*e.rate:null})),count:L.a(e[1],(function(e){return e.consumption}))}}));var o,i=ne[this.chartView].avgStringFormat,m=Object(f.a)(e);try{for(m.s();!(o=m.n()).done;){var d=o.value,u=P.a(l,(function(e){return s()(e.x,"L").format(i)===d.x}));"week"===this.chartView&&(d.x="".concat(s()(d.x,i).startOf("week").format("DD"),"-").concat(s()(d.x,i).endOf("week").format("DD MMM YYYY"))),d.rate=A.a(u,(function(e){return e.count>45?e.rate:null})),d.consumption=A.a(u,(function(e){return e.count>45?e.use:null})),d.cost=A.a(u,(function(e){return e.count>45?e.cost:null}))}}catch(h){m.e(h)}finally{m.f()}}return e}},{key:"processActlView",value:function(e){if("hour"===this.chartView){var t=s()(this.state.dateRange[0]),a=s()(this.state.dateRange[1]).set({hour:0,minutes:0,seconds:0}).add(1,"d"),n=s()(t).add(11,"d");(e=P.a(this.state.useBlocks,(function(e){return e.time.isBetween(t,a,"minute","[)")&&e.time.isBefore(n)})).map((function(e){return{x:e.time.format("DD MMM HH:mm"),rate:e.rate,consumption:e.consumption,cost:e.consumption>=0?e.rate*e.consumption:null}}))).reverse()}else{var r=ne[this.chartView].actlStringFormat,c=W.b(this.state.useBlocks,(function(e){return e.time.format(r)}));c=c.map((function(e){return{x:e[0],rate:A.a(e[1],(function(e){return e.rate})),use:_.a(e[1],(function(e){return e.consumption})),cost:_.a(e[1],(function(e){return e.consumption>=0?e.consumption*e.rate:null}))}}));var l,o=Object(f.a)(e);try{for(o.s();!(l=o.n()).done;){var i=l.value,m=P.a(c,(function(e){return e.x===i.x}));"week"===this.chartView&&(i.x="".concat(s()(i.x,r).startOf("week").format("DD"),"-").concat(s()(i.x,r).endOf("week").format("DD MMM YYYY"))),i.rate=A.a(m,(function(e){return e.rate})),i.consumption=_.a(m,(function(e){return e.use})),i.cost=_.a(m,(function(e){return e.cost}))}}catch(d){o.e(d)}finally{o.f()}}return e}},{key:"componentDidMount",value:function(){var e=this;d("GET","consumptionHistory",(function(t,a){if(200===a){var n=t.leccyUse;n=n.map((function(e){return{time:s()(e.interval_start),rate:e.rate,consumption:e.consumption}})),e.setState({useBlocks:n},e.processAnyViewTypeChange);var r=n.map((function(e){return e.time}));e.setState({datesLimit:[s.a.min(r).set({hour:0,minute:0,second:0,millisecond:0}).subtract(1,"d"),s.a.max(r).set({hour:0,minute:0,second:0,millisecond:0}).add(1,"d")]})}else alert("There was an error")}))}},{key:"render",value:function(){if(this.state.dataPlot.length>0){var e="".concat(ae[this.chartType].label," Usage ");if(this.state.dateRange[0].format("L")===this.state.dateRange[1].format("L"))e+="on ".concat(this.state.dateRange[0].format("DD MMM YYYY"));else if("actl"===this.chartType&&"hour"===this.chartView){var t=s()(this.state.dataPlot[this.state.dataPlot.length-1].x,ne.hour.actlStringFormat).format("DD MMM YYYY");e+="from ".concat(this.state.dateRange[0].format("DD MMM YYYY")," to \n                                ").concat(t)}else e+="from ".concat(this.state.dateRange[0].format("DD MMM YYYY")," to \n                                ").concat(this.state.dateRange[1].format("DD MMM YYYY"))}return this.state.dataPlot.length>0?r.a.createElement("div",null,r.a.createElement("div",{className:"row my-3 mx-4"},r.a.createElement("div",{className:"col-2"},r.a.createElement(y.a,{className:"btn btn-primary btn-arrow-left",id:"prev-date-range",onClick:this.prevNextClicked},"Previous")),r.a.createElement("div",{className:"col-8 text-center",align:"center"},r.a.createElement("h4",{className:"font-weight-bold"},e)),r.a.createElement("div",{className:"col-2",align:"right"},r.a.createElement(y.a,{className:"btn btn-primary btn-arrow-right",id:"next-date-range",onClick:this.prevNextClicked},"Next"))),r.a.createElement("div",{className:"row mb-3"},r.a.createElement(X,{data:this.state.dataPlot,barPlotOptions:te[this.state.chartBarPlot],chartView:this.chartView})),r.a.createElement("div",{className:"row justify-content-center my-3"},r.a.createElement("div",{className:"col-lg-2 col-md-4 my-1",align:"center"},r.a.createElement(G,{btnType:"type",stateVar:this.chartType,onValueChange:this.chartOptionChanged})),r.a.createElement("div",{className:"col-lg-4 col-md-6 my-1",align:"center"},r.a.createElement(G,{btnType:"view",stateVar:this.chartView,onValueChange:this.chartOptionChanged})),r.a.createElement("div",{className:"col-lg-2 col-md-4 my-1",align:"center"},r.a.createElement(G,{btnType:"plot",stateVar:this.state.chartBarPlot,onValueChange:this.chartOptionChanged})),r.a.createElement("div",{className:"col-lg-4 col-md-8 my-1",align:"center"},r.a.createElement(q,{ref:this.dateRangeElement,datesLimit:this.state.datesLimit,dateRange:this.state.dateRange,datesChanged:this.datesChanged}))),r.a.createElement($,{dataPlots:this.state.dataPlot,chartType:this.chartType,chartView:this.chartView})):r.a.createElement("div",{className:"text-center"},r.a.createElement("div",{className:"spinner-border",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")))}}]),a}(n.Component),te={consumption:{key:"consumption",label:"Consumption",unit:"kWh"},cost:{key:"cost",label:"Cost",unit:"p"},rate:{key:"rate",label:"Rate",unit:"p"},avgCost:{key:"avgCost",label:"Average Unit Cost",unit:"p/kWh"}},ae={avg:{label:"Average"},actl:{label:"Actual"}},ne={hour:{label:"Hourly",avgStringFormat:"HH:mm",actlStringFormat:"DD MMM HH:mm"},day:{label:"Daily",avgStringFormat:"dddd",actlStringFormat:"YYYY-MM-DD"},week:{label:"Weekly",avgStringFormat:"ww YYYY",actlStringFormat:"ww YYYY"},month:{label:"Monthly",avgStringFormat:"MMMM",actlStringFormat:"MMM YYYY"}},re=a(214),ce=a.n(re);function le(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),c=a[0],l=a[1],i=Object(n.useState)([]),s=Object(o.a)(i,2),m=s[0],u=s[1],h=Object(n.useState)(20),f=Object(o.a)(h,2),g=f[0],v=f[1],p=function(e){e.target.blur();var t=e.target.title,a="hotWater"===t?!c.boost:!m.boost;d("POST","boost/set",E,{boost:t,value:a,duration:g})},E=function(e,t){200===t||201===t?(l(e.hotWater),u(e.heating)):alert("There was an error"),M("boost-states-card-spinner")};return Object(n.useEffect)((function(){d("GET","boost",E)}),[]),r.a.createElement("div",null,r.a.createElement("div",{className:"mx-5"},r.a.createElement(ce.a,{value:g,onChange:function(e){v(e.target.value)},min:20,max:100,variant:"primary",size:"lg",tooltip:"on",tooltipLabel:function(e){return"".concat(e,"mins")}})),r.a.createElement("div",{className:"row justify-content-center mt-5 mx-3"},r.a.createElement("div",{className:"col-6",align:"center"},r.a.createElement(oe,{value:"hotWater",onClickCallback:p,boostState:c})),r.a.createElement("div",{className:"col-6",align:"center"},r.a.createElement(oe,{value:"heating",onClickCallback:p,boostState:m}))))}function oe(e){var t=e.value,a=e.onClickCallback,c=e.boostState,l=Object(n.useState)(!1),i=Object(o.a)(l,2),m=i[0],d=i[1],u="hotWater"===t?"Hot Water":"Heating",h=s()(c.endTime),f=m?r.a.createElement("h5",{title:t},"Stop",r.a.createElement("br",null),"Boost"):r.a.createElement("h5",{className:"text-center",title:t},"Boosting till ",h.format("HH:mm"),r.a.createElement("br",null),"(","".concat(h.diff(s()(),"m"),"min").concat(h.diff(s()(),"m")>1?"s":""," remaining"),")");return c.boost?r.a.createElement(y.a,{size:"lg",block:!0,variant:"danger",onClick:a,title:t,onMouseEnter:function(e){d(!0)},onMouseLeave:function(e){d(!1)}},r.a.createElement("h5",{className:"font-weight-bold alert-heading text-center pt-1",title:t},u),r.a.createElement("hr",{className:"alert-danger"}),f):r.a.createElement(y.a,{size:"lg",block:!0,onClick:a,title:t},r.a.createElement("h5",{className:"font-weight-bold alert-heading text-center pt-1",title:t},u),r.a.createElement("hr",{className:"alert-primary"}),r.a.createElement("h5",{title:t},"Boost"))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(456),a(457);var ie=document.getElementById("root");ie&&l.a.render(r.a.createElement(B,{type:"homepage"}),ie);var se=document.getElementById("boilerStateRows");se&&l.a.render(r.a.createElement(h,{limit:0}),se);var me=document.getElementById("boilerStateCard");me&&l.a.render(r.a.createElement(h,{limit:5}),me);var de=document.getElementById("agileRateTable");de&&l.a.render(r.a.createElement(T,null),de);var ue=document.getElementById("agile-rates-card");ue&&l.a.render(r.a.createElement(B,{type:"homepage"}),ue),(ue=document.getElementById("agile-rates-page-cards"))&&l.a.render(r.a.createElement(B,{type:"top"}),ue);var he=document.getElementById("nest-card-content");he&&l.a.render(r.a.createElement(V,null),he),document.getElementById("current-states-card-body")&&d("GET","currentStates",I,{});var fe=document.getElementById("consumption-page");fe&&l.a.render(r.a.createElement(ee,null),fe);var ge=document.getElementById("boost-states-card-content");ge&&l.a.render(r.a.createElement(le,null),ge);var ve=document.getElementById("hot-water-schedule-card");ve&&l.a.render(r.a.createElement(O,null),ve),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[241,1,2]]]);
//# sourceMappingURL=main.33620f21.chunk.js.map